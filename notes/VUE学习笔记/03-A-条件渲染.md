# 条件渲染

> **对应实验室**: LabDirectives  
> **涉及源文件**: App.vue, components/*.vue

## 1. v-if 指令

`v-if` 用于条件性地渲染元素，条件为假时**元素不会出现在 DOM 中**：

```vue
<template>
  <div v-if="isLoggedIn">
    欢迎回来，{{ username }}！
  </div>
</template>

<script setup>
import { ref } from 'vue'
const isLoggedIn = ref(true)
const username = ref('樱花')
</script>
```

## 2. v-else 和 v-else-if

```vue
<template>
  <div v-if="score >= 90">优秀 🏆</div>
  <div v-else-if="score >= 60">及格 ✅</div>
  <div v-else>不及格 ❌</div>
</template>

<script setup>
import { ref } from 'vue'
const score = ref(85)
</script>
```

> ⚠️ `v-else` 和 `v-else-if` 必须紧跟在 `v-if` 或 `v-else-if` 后面。

## 3. v-show 指令

`v-show` 通过 CSS `display` 属性来切换可见性，**元素始终存在于 DOM 中**：

```vue
<template>
  <div v-show="isVisible">
    这个元素始终在 DOM 中，只是可能被隐藏
  </div>
</template>
```

## 4. v-if vs v-show

| 特性 | v-if | v-show |
|------|------|--------|
| DOM 操作 | 销毁/重建 | 切换 display |
| 初始渲染 | 条件假则不渲染 | 总是渲染 |
| 切换开销 | 高 | 低 |
| 适用场景 | 条件很少改变 | 频繁切换 |

```vue
<template>
  <!-- 查看 DevTools 中的 DOM 结构差异 -->
  
  <!-- v-if：条件为假时，元素不在 DOM 中 -->
  <div v-if="show">v-if content</div>
  
  <!-- v-show：元素始终在 DOM 中，只是 display: none -->
  <div v-show="show">v-show content</div>
</template>
```

## 5. 本站实例

### 5.1 搜索结果显示

```vue
<!-- 📍 SearchModal.vue -->
<template>
  <div class="search-results">
    <!-- 有结果时显示列表 -->
    <ul v-if="hasResults">
      <li v-for="result in searchResults" :key="result.path">
        {{ result.title }}
      </li>
    </ul>
    
    <!-- 无结果时显示提示 -->
    <div v-else class="no-results">
      {{ t.search_no_results }}
    </div>
  </div>
</template>
```

### 5.2 加载状态

```vue
<!-- 📍 ArticleCard.vue -->
<template>
  <div>
    <!-- 加载中 -->
    <div v-if="isLoading" class="skeleton">
      加载中...
    </div>
    
    <!-- 加载完成 -->
    <article v-else>
      <h1>{{ article.title }}</h1>
      <p>{{ article.content }}</p>
    </article>
  </div>
</template>
```

### 5.3 侧边栏切换

```vue
<!-- 📍 App.vue -->
<template>
  <!-- 使用 v-show 因为侧边栏频繁切换 -->
  <aside v-show="sidebarOpen" class="sidebar">
    <AppSidebar />
  </aside>
</template>
```

## 6. 在 `<template>` 上使用 v-if

当需要条件渲染多个元素时，可以在 `<template>` 上使用 `v-if`：

```vue
<template>
  <template v-if="isAdmin">
    <h1>管理员面板</h1>
    <nav>管理导航</nav>
    <main>管理内容</main>
  </template>
  
  <template v-else>
    <h1>用户面板</h1>
    <main>用户内容</main>
  </template>
</template>
```

`<template>` 是一个不可见的包装器，不会渲染到 DOM 中。

## 7. v-if 与 v-for

> ⚠️ **不推荐**同时在一个元素上使用 `v-if` 和 `v-for`。

```vue
<!-- ❌ 不推荐 -->
<li v-for="user in users" v-if="user.isActive">
  {{ user.name }}
</li>

<!-- ✅ 推荐：使用计算属性过滤 -->
<li v-for="user in activeUsers">
  {{ user.name }}
</li>

<script setup>
const activeUsers = computed(() => 
  users.value.filter(user => user.isActive)
)
</script>
```

或者将 `v-if` 移到外层：

```vue
<!-- ✅ 推荐：v-if 在外层 -->
<template v-if="users.length > 0">
  <li v-for="user in users" :key="user.id">
    {{ user.name }}
  </li>
</template>
<p v-else>暂无用户</p>
```

## 8. 条件渲染的性能考虑

```vue
<script setup>
// 场景1：登录后才显示的内容
// 使用 v-if（初始不渲染，切换少）
</script>
<template>
  <AdminPanel v-if="isAdmin" />
</template>

<script setup>
// 场景2：频繁切换的 Tab
// 使用 v-show（避免重复渲染）
</script>
<template>
  <div v-show="activeTab === 'tab1'">Tab 1 内容</div>
  <div v-show="activeTab === 'tab2'">Tab 2 内容</div>
</template>
```

---

## 🧪 动手实验

本章节对应实验室：**LabDirectives**

完成以下练习：
1. [ ] 在实验室中切换 v-if/v-show，观察 DOM 变化
2. [ ] 理解什么时候用 v-if，什么时候用 v-show
3. [ ] 实现一个带加载状态的组件

---

## 📝 小结

| 指令 | 作用 | DOM 行为 |
|------|------|----------|
| `v-if` | 条件渲染 | 销毁/重建元素 |
| `v-else-if` | 多条件分支 | - |
| `v-else` | 条件取反 | - |
| `v-show` | 显示/隐藏 | 切换 `display` |
