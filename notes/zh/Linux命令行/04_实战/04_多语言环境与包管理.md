# 📦 多语言环境与包管理 (Language Environments & Pkg Management)

> 💡 **新手选择恐惧症救星**
> 如果你刚接触开发，面对下面琳琅满目的工具不知道选哪个，请直接看这里：
> - **一站式管理 (全能)**：请认准 **mise**。一个工具管理所有语言版本，极致轻量快速。
> - **Python**：请认准 **uv**。它一个顶五个，极速且简单。
> - **Node.js**：请认准 **fnm**。速度最快且支持跨平台。
> - **数据科学/AI**：请认准 **mamba**。比 conda 快得多。
> - **Java**：请认准 **SDKMAN!**。版本切换神器。

## 1. Python：通用开发首选 —— **uv** (推荐) & **pip** (标准)

> **核心特点**：Rust 编写、极速。
> **定位**：目前最推荐的 Python“管家”。它不仅替代了 `pip` 和 `poetry`，还接管了 `pyenv` 的功能（安装 Python、创建环境、下载包全包了）。
> **💡 给初学者的建议**：虽然 `uv` 极快，目前已成为趋势，但市面上 90% 的老项目和教程仍在使用 `pip`。你需要理解 `pip` 是标准底座，而 `uv` 是目前最好用的生产力增强方案。

### 1.1 项目初始化 (起手式)

不再需要手动建文件夹，`uv init` 直接生成包含 `pyproject.toml` 的现代标准结构。

```bash
# 1. 创建并初始化项目 (默认创建 .venv)
mkdir myproject && cd myproject

# 2. 初始化项目 (指定 Python 版本)
# 这一步会自动生成 pyproject.toml 文件，这是现代 Python 的核心配置
uv init --python 3.10
```

### 1.2 Python 版本管理 (替代 Pyenv)

`uv` 自带 Python 下载器，无需去官网下载安装包，也无需配置复杂的环境变量。

```bash
# 查看所有能安装的版本
uv python list

# 安装特定版本 (无需管理员权限，极速下载)
uv python install 3.10 3.11 3.12
```

### 1.3 包管理 (替代 Pip & Poetry)

**核心逻辑**：修改配置文件 -> 同步到环境。

* **常规依赖**：生产环境需要的包 (e.g., `pandas`, `requests`)。
* **开发依赖**：只有开发时需要的包 (e.g., `pytest`, `black`)，打包时不带走。

```bash
# 1. 添加依赖 (自动写入 pyproject.toml 并安装)
uv add requests pandas

# 2. 添加"开发"依赖 (加 --dev 参数)
uv add --dev pytest black ruff

# 3. 删除依赖
uv remove requests

# 4. 同步环境 (最重要的一步！)
# 当你拉取队友的代码后，执行此命令，uv 会根据 uv.lock 
# 将你的环境瞬间同步到和队友一模一样的状态
uv sync

# 5. 生产环境部署 (严格模式)
# 只要 lock 文件里的版本，不更新任何包
uv sync --frozen
```

### 1.4 运行代码 (隐式激活)

你不再需要手动输入 `source .venv/bin/activate`。`uv run` 会临时加载虚拟环境并执行命令。

```bash
# 运行脚本
uv run main.py

# 运行工具 (比如 pytest 或 black)
# 即使你没有全局安装 black，只要虚拟环境里有，就能跑
uv run pytest
uv run black .
```

### 1.5 旧项目迁移 (最痛的场景)

接手只有 `requirements.txt` 的老项目，如何无缝切换到 `uv`？

```bash
# 场景 A: 只有 requirements.txt
# 将其编译为 uv.lock，并同步环境
uv pip compile requirements.txt -o uv.lock
uv sync

# 场景 B: 传统的 venv 管理方式 (混合模式)
# 如果你不想用 uv 管理整个项目结构，只想用它代替 pip 安装包
uv venv                       # 创建环境
source .venv/bin/activate     # 激活
uv pip install -r requirements.txt  # 极速安装
```

### 1.6 传统包管理器 (Pip & Poetry)
即使有了 `uv`，你可能仍需处理老项目：
- `pip install -r requirements.txt`：最基础的安装方式。
- `poetry install`：基于 `pyproject.toml` 的老牌管理方式。

---

## 2. 通用版本管理神器：mise (原 rtx)

> **定位**：`asdf` 的 Rust 重写版，**全语言通用**的“遥控器”。
> **为什么要用它？**：如果你不想为了 Node 装 `fnm`，为了 Java 装 `SDKMAN!`，为了 Python 装 `pyenv`，那么 `mise` 就是为你准备的。它支持数百种语言（Go, Ruby, Node, Python, Java, Rust 等）的版本管理。

### 2.1 基础操作
```bash
# 1. 安装一个工具 (以 Node 为例)
mise use node@20

# 2. 安装特定版本并在当前目录生效 (生成 .mise.toml)
mise use python@3.11

# 3. 查看当前生效的所有工具版本
mise ls
```

### 2.2 核心优势
- **极致速度**：比 `asdf` 快得多，没有任何 Shell 延迟。
- **配置即环境**：项目目录下放一个 `.mise.toml`，任何协作成员进入该目录都会自动激活对应的语言版本。
- **无缝衔接**：它甚至可以兼容 `SDKMAN!` 和 `nvm` 的配置文件。

---

## 3. Python：数据科学/AI 首选 —— **Conda / Mamba**

> **核心特点**：C++ 重写、解决依赖解析慢的问题。
> **定位**：数据科学与 AI 领域的首选。做 AI 需要安装 PyTorch、TensorFlow 等巨型库及显卡驱动，传统 pip 难以搞定。**Mamba** 就是“加了涡轮增压”的 Conda。

### 2.1 基础命令 (Mamba 与 Conda 通用)

**💡 Pro Tip**: 强烈建议使用 **mamba** (或 **micromamba**) 替代 **conda**。命令参数几乎完全通用，但速度极快。

```bash
# 1. 创建指定 Python 版本的环境 (例如命名为 "ai_env")
# 对应 Conda: conda create -n ai_env python=3.10
mamba create -n ai_env python=3.10

# 2. 激活环境 (进入“小厨房”)
# 对应 Conda: conda activate ai_env
mamba activate ai_env

# 3. 安装复杂的 AI 包 (从 conda-forge 或默认源，速度远超 conda install)
# 对应 Conda: conda install pytorch
mamba install pytorch torchvision -c pytorch
```

### 2.2 环境迁移与复刻

```bash
# 导出当前环境配置
conda env export > environment.yml

# 根据配置复刻环境
conda env create -f environment.yml
```

---

## 3. Java：环境与构建管理

**痛点**：老项目用 Java 8，新项目用 Java 17/21，手动卸载重装极其麻烦。

### 3.1 环境总管 —— **SDKMAN!**

> **定位**：Java 版本的“遥控器”。可以在不同 JDK 版本 (8, 11, 17, 21) 之间秒级切换。

#### 常用命令

```bash
# 1. 列出所有可用的 Java 发行版 (Temurin, Corretto, Oracle 等)
sdk list java

# 2. 安装指定版本的 JDK (例如最稳的 Java 17)
sdk install java 17.0.9-tem

# 3. 临时切换：在当前终端使用特定版本
sdk use java 17.0.9-tem
# 或者切回旧版: sdk use java 8.0.392-tem

# 4. 设置默认：系统默认使用的 Java 版本
sdk default java 21.0.1-graal

# 5. 查看当前正在使用的所有 SDK 版本
sdk current
```

#### 其他工具安装

```bash
# 安装构建工具，无需手动配置 Path
sdk install maven
sdk install gradle
```

> **💡 Pro Tip**: 在项目根目录下创建一个 **.sdkmanrc** 文件，写入 `java=17.0.9-tem`。之后每次进入该目录，只需输入 **`sdk env`**，即可自动切换到该项目所需的 JDK 版本。

### 3.2 构建工具 —— **Maven / Gradle**

> **定位**：代码的“流水线工人”。负责编译、打包 (生成 .jar/.war)。

* **Maven**: 传统、稳重。

  ```bash
  # 清理并打包项目
  mvn clean install
  # 查看项目依赖树 (排查 jar 包冲突神器)
  mvn dependency:tree
  ```
* **Gradle**: 灵活、现代（Android 开发常用）。

  ```bash
  # 构建项目
  gradle build
  # 查看 Gradle 项目的依赖树
  gradle dependencies
  ```

---

## 4. Node.js：前端开发必备

**痛点**：前端界更新极快，不同项目依赖不同版本的 Node.js。

### 4.1 版本管理 —— **fnm** (推荐) / **nvm** (经典)

> **定位**：Node.js 的“遥控器”。
> **💡 建议**：如果你在寻找一个成熟、通用的方案，**nvm** 是工业界使用最广的（但启动慢）；如果你追求速度和跨平台，**fnm** 是最佳选择。fnm 使用 Rust 编写，**跨平台 (支持 Windows)**，速度极快，且不需要复杂的 Shell 启动配置。

```bash
# 1. 列出可安装的 Node.js 版本
fnm list-remote

# 2. 安装最新的 LTS (长期支持) 版本
fnm install --lts

# 3. 切换到 Node 20 版本
fnm use 20
```

### 4.2 包管理器 —— **pnpm** (推荐)

> **定位**：替代 npm/yarn 的高效包管理器。
> **原理**：`npm` 会把同一个包在电脑里存几十份（每个项目一份），而 **`pnpm` 利用硬链接机制，只在磁盘存一份**，其他项目链接过去，极度节省硬盘空间且安装速度极快。

```bash
# 1. 安装 pnpm (通常通过 npm 全局安装)
npm install -g pnpm

# 2. 安装项目依赖
pnpm i  # 或 pnpm install

# 3. 启动项目
pnpm start
```

---

## 5. Linux：系统级包管理 (进阶侦探手册)

在配置开发环境前，掌握系统的“自愈”与“追踪”能力至关重要。

### 5.1 APT (Debian/Ubuntu) 核心技巧

- **精准搜索**：`apt search <keyword> | grep ^<keyword>` (只看以关键字开头的包)。

- **`apt-file` (终极侦探)**：搜索哪个包包含某个文件。
  - **场景**：编译时报错缺 `stdio.h`？执行 `sudo apt install apt-file && sudo apt-file update` 后，运行 `apt-file search stdio.h` 即可锁定包名。
- **`apt-mark hold` (环境锁)**：防止系统升级时自动更新关键包（如 Nginx/Docker）。
  - **锁定**：`sudo apt-mark hold nginx`
  - **解锁**：`sudo apt-mark unhold nginx`
- **`apt install -f` (自动补救)**：当 `dpkg` 安装本地包提示缺少依赖时，运行此命令让 APT 自动修复并完成安装。
- **清理垃圾**：`sudo apt autoremove` (删除不再需要的孤立依赖包)。

### 5.2 DPKG (底层管理)
- **查找真名**：`dpkg -l | grep keyword`。卸载软件需要使用“包名”而非“文件名”。
- **追踪文件**：`dpkg -L <包名>`。查看一个软件到底在你的系统里“塞”了哪些文件及其位置。
- **彻底卸载**：`sudo dpkg -P <包名>` (与 `-r` 的区别在于它会连同配置文件一起抹除)。

### 5.3 DNF / RPM (RHEL/CentOS/Fedora)
- **查找提供者**：`dnf provides ifconfig` (当不知道该装哪个包才能用某个命令时使用)。
- **查看详情**：`sudo dnf info docker`。

### 5.4 Homebrew on Linux (无 root 权限神器)
- **场景**：在公司服务器上安装最新版 Git 或 Node，而你没有 sudo 权限。
- **操作**：`brew install gcc node git`。软件将安装在用户家目录下。

### 5.5 APT 锁死修复
当安装中断提示 `Could not get lock` 时：
```bash
sudo rm /var/lib/dpkg/lock*
sudo dpkg --configure -a
```
